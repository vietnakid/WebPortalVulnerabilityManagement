{% extends "index.html" %}

{% block body %}
<h2>Target detail:</h2>

<form method="GET" action="">
    <input type="text" name="q" placeholder="searching..." value="{{search_query}}" />
    <button type="submit">Search</button>
</form>

<h3>Common data:</h3>

<div>
    <label>Targets: </label> {{nmapData.target}}
</div>

<div>
    <label>HostName: </label> {{nmapData.hostname}}
</div>

<div>
    <label>Status:</label> {{nmapData.status}}
</div>

<div>
    <label>Scan ID:</label><a href = '/scan/detail/{{nmapData.root_scan_id}}'> {{nmapData.scan_id}} </a>
</div>

<div>
    <label>Scan Name:</label> {{nmapData.scan_name}}
</div>

<div>
    <label>Init time:</label> {{nmapData.init_time}}
</div>

<ul class="nav nav-pills mb-3 nav-fill" id="nav-target" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="nmap-tab" data-toggle="pill" href="#nmap" role="tab" aria-controls="nmap" aria-selected="true">Nmap</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="wappalyzer-tab" data-toggle="pill" href="#wappalyzer" role="tab" aria-controls="wappalyzer" aria-selected="true">Wappalyzer</a>
      </li>
    <li class="nav-item">
      <a class="nav-link" id="cvesearch-tab" data-toggle="pill" href="#cvesearch" role="tab" aria-controls="cvesearch" aria-selected="false">CVESearch</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="nikto-tab" data-toggle="pill" href="#nikto" role="tab" aria-controls="nikto" aria-selected="false">Nikto</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="acunetix-tab" data-toggle="pill" href="#acunetix" role="tab" aria-controls="acunetix" aria-selected="false">Acunetix</a>
    </li>
    <li class="nav-item">
    <a class="nav-link" id="nessus-tab" data-toggle="pill" href="#nessus" role="tab" aria-controls="nessus" aria-selected="false">Nessus</a>
    </li>
  </ul>

  <!-- Nmap -->
  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="nmap" role="tabpanel" aria-labelledby="nmap-tab">
        <table style="width:100%">
            <tr>
                <th>#</th>
                <th>Port</th>
                <th>OS_Product_Version</th>
                <th>CPE</th>
                <th>NSE Script</th>
            </tr>
        
            {% for item in nmapData.openports %}
            <tr>
                <td> {{loop.index}} </td>
                <td> {{item.port}} </td>
                <td> {{item.os_product_version}} </td>
                <td> {{item.cpe}} </td>
                <td>
                    <table>
                        {% for nse_item in item.nseOutput %}
                        <tr>
                            <td>{{nse_item.script}}</td>
                            <td>{{nse_item.output}}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </td>
                
            </tr>
            {% endfor %}
        
        </table>
    </div>

    <!-- Wappalyzer -->
    <div class="tab-pane fade" id="wappalyzer" role="tabpanel" aria-labelledby="wappalyzer-tab">
        <table style="width:100%">
            <tr>
                <th>#</th>
                <th>Port</th>
                <th>Path</th>
                <th>Technologies</th>
            </tr>
        
            {% for item in wappalyzerData %}
            <tr>
                <td> {{loop.index}} </td>
                <td> {{item.port}} </td>
                <td> {{item.path}} </td>
                <td> 
                            {% for application in item.applications %}
                                {{application.name}} : {{application.version}} <br>
                            {% endfor %} 
                </td>
                
            </tr>
            {% endfor %}
        
        </table>
    </div>

    <!-- CVE Search -->
    <div class="tab-pane fade" id="cvesearch" role="tabpanel" aria-labelledby="cvesearch-tab">
        <table style="width:100%">
                <tr>
                    <th>#</th>
                    <th>Product</th>
                    <th>CWE</th>
                    <th>CVE</th>
                    <th>CVSS Score</th>
                </tr>
            
                {% for item in cvesearchData %}
                <tr>
                    <td> {{loop.index}} </td>
                    <td> {{item.cpe}} </td>
                    <td> {{item.cwe}} </td>
                    <td> <a href="{{'https://cve.circl.lu/cve/' + item.cve}}" target="_blank">{{item.cve}}</a> </td>
                    <td> {{item.cvss}} </td>
                </tr>
                {% endfor %}
            
            </table>
    </div>

    <!-- Nikto -->
    <div class="tab-pane fade" id="nikto" role="tabpanel" aria-labelledby="nikto-tab">
        <table style="width:100%">
                <tr>
                    <th>#</th>
                    <th>Method</th>
                    <th>URL</th>
                    <th>Message</th>
                    <th>OSVDB</th>
                </tr>
            
                {% for item in niktoData %}
                <tr>
                    <td> {{loop.index}} </td>
                    <td> {{item.method}} </td>
                    <td> {{item.url}} </td>
                    <td> {{item.msg}} </td>
                    <td> {{item.OSVDB}} </td>
                </tr>
                {% endfor %}
            
            </table>
    </div>

    <!-- Acunetix -->
    <div class="tab-pane fade" id="acunetix" role="tabpanel" aria-labelledby="acunetix-tab">
        <table style="width:100%">
            <tr>
                <th>#</th>
                <th>Vulnerability</th>
                <th>URL</th>
                <th>Parameter</th>
                <th>CVSS Score</th>
                <th>Severity</th>
            </tr>
        
            {% for item in acunetixData %}
            <tr>
                <td> {{loop.index}} </td>
                <td> <a href = '/acunetix/detail/{{nmapData.scan_id}}/{{item.vuln_id}}'> {{item.vt_name}} </a> </td>
                <td> {{item.affects_url}} </td>
                <td> {{item.affects_detail}} </td>
                <td> {{item.cvss_score}} </td>
                <td> {{item.severity}} </td>
            </tr>
            {% endfor %}
        
        </table>
    </div>

    <!-- Nessus -->
    <div class="tab-pane fade" id="nessus" role="tabpanel" aria-labelledby="nessus-tab">
        <table style="width:100%">
                <tr>
                    <th>#</th>
                    <th>Plugin Name</th>
                    <th>Plugin Output</th>
                    <th>Description</th>
                    <th>Solution</th>
                    <th>CVSS Score</th>
                </tr>
            
                {% for item in nessusData %}
                <tr>
                    <td> {{loop.index}} </td>
                    <td> {{item.pluginname}} </td>
                    <td> {{item.plugin_output}} </td>
                    <td> {{item.description}} </td>
                    <td> {{item.solution}} </td>
                    <td> {{item.cvss}} </td>
                </tr>
                {% endfor %}
            </table>
    </div>
  </div>
{%endblock%}