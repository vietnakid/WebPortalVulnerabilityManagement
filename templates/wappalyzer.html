{% extends "index.html" %}

{% block head %}
    <script src="/static/js/bootstrap-paginator.min.js"></script>
    <link href="/static/css/bootstrap-combined.min.css" rel="stylesheet">
{% endblock  %}

{% block body %}
<h2>Wappalyzer result:</h2>
<br>
<p><b>Total: {{response.total}} </b></p>

<div>
    Show: 
    <select id="paging_size">
        <option value="10" {% if paging.paging_size == 10 %} selected="selected"{% endif %}>10</option>
        <option value="20" {% if paging.paging_size == 20 %} selected="selected"{% endif %}>20</option>
        <option value="50" {% if paging.paging_size == 50 %} selected="selected"{% endif %}>50</option>
        <option value="100" {% if paging.paging_size == 100 %} selected="selected"{% endif %}>100</option>
    </select>
    Entries per page.
</div>
<br>

<table style="width:75%">
    <tr>
        <th>#</th>
        <th>Target</th>
        <th>Hostname</th>
        <th>Scan ID</th>
        <th>Scan Name</th>
        <th>Technologies</th>
    </tr>
    {% for item in response.data %}
    <tr>
        <td> {{loop.index + paging.paging_from}} </td>
        <td> <a href="detail?id={{item.id}}"> {{item.target}} </td>
        <td>{{item.hostname}} </td>
        <td> <a href = '/scan/detail/{{item.root_scan_id}}'> {{item.scan_id}} </a> </td>
        <td> {{item.scan_name}} </td>
        <td>
            {% for app in item.result %}
            <a>{{app.port}} :
                {%for ser in app.applications %}
                {{ser.name}} {{ser.version}},
                {%endfor%}
            </a>
            </br>
            {%endfor%}
        </td>

    </tr>
    {% endfor %}

</table>

<div id="paging" style="display:block"></div>

<script type='text/javascript'>
    var paging_options = {
        currentPage: Math.ceil({{(paging.paging_from / paging.paging_size)}} + 0.1),
        totalPages: Math.ceil({{(paging.paging_total / paging.paging_size)}}),
        size:'normal',
        alignment:'center',
        pageUrl: function(type, page, current){
            fromPage = (page-1) * {{paging.paging_size}}
            currentURL = document.location.href;

            url = new URL(currentURL);
            url.searchParams.set('from', fromPage);
            
            return url;
        },
        onPageClicked: function(e,originalEvent,type,page){
            e.stopImmediatePropagation();
        }
    }

    $('#paging').bootstrapPaginator(paging_options);
</script>

{%endblock%}