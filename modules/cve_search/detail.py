# Import from standard library
import logging
from datetime import datetime

# Import from third-party
from flask import Flask, render_template, json, request, jsonify, session

# Import local files
import DAO.db_connect as db_connect
from config.config import ElasticConfig
from modules.cve_search.process_cve import processCVE, processCveDetail


def cve_detail():
    id = request.args.get('id')
    if id is None:
        return redirect('404.html')
    else:
        try:
            es = db_connect.connect_elasticsearch()
            try:
                raw_data = es.get(index=ElasticConfig.CVESEARCH_INDEX,
                                  doc_type="_doc", id=id)
                processed_data = processCveDetail(raw_data)
            except:
                logging.exception(msg="Fail")
                return render_template('404.html')
        except:
            logging.exception(msg="Fail")
            return render_template('404.html')
    session['module'] = "cve"
    return render_template('cve-detail.html', response=processed_data)
