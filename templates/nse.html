{% extends "index.html" %}

{% block body %}
<div class="container-fluid">

    <!-- Page Heading -->
    <h1 class="h2 mb-2 text-gray-800">NSE result: <span style="color: crimson">{{response.total}}</span></h1>

    {% if q != None %}
    <p class="mb-4" style="font-size: 20px"> Showing search result for: "
        <span style="color: crimson; font-style: italic; font-size: 22px">{{q}}</span>" </p>
    {% endif %}

    <div>
        Show:
        <select id="paging_size" class="custom-select custom-select-sm" style="width: 5%">
            <option value="10" {% if paging.paging_size == 10 %} selected="selected" {% endif %}>10</option>
            <option value="20" {% if paging.paging_size == 20 %} selected="selected" {% endif %}>20</option>
            <option value="50" {% if paging.paging_size == 50 %} selected="selected" {% endif %}>50</option>
            <option value="100" {% if paging.paging_size == 100 %} selected="selected" {% endif %}>100</option>
        </select>
        Entries per page.
    </div>
    <br>


    <!-- DataTales-->
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                    <!-- Sort -->
                    <div class="row">
                        <div class="col-sm-12 col-md-6">
                            <div class="dataTables_length" id="dataTable_length">
                                <label>Sort by
                                    <select id="sort" name="dataTable_length" aria-controls="dataTable"
                                        class="custom-select custom-select-sm form-control form-control-sm">
                                        <option value="1" {% if sorting == "scanstat.startTime:desc" %}
                                            selected="selected" {% endif %}>
                                            Init time desc </option>
                                        <option value="2" {% if sorting == "scanstat.startTime:asc" %}
                                            selected="selected" {% endif %}>
                                            Init time asc </option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>
                    <!-- Sort -->

                    <!-- Table -->
                    <div class="row">
                        <div class="col-sm-12">
                            <table class="table table-bordered dataTable" id="dataTable" width="100%" cellspacing="0"
                                role="grid" aria-describedby="dataTable_info" style="width: 100%;">
                                <!-- Head -->
                                <thead>
                                    <tr role="row">
                                        <th style="width: 30px">#</th>
                                        <th class="sorting_asc" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Target</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 197px;">Hostname</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Status</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Init Time</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Scan Time</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Scan ID</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">Scan Name</th>
                                        <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                                            colspan="1" style="width: 143px;">NSE Scripts</th>
                                    </tr>
                                </thead>
                                <!-- End Head -->

                                <!-- Body -->
                                <tbody>
                                    {% for item in response.data %}
                                    <tr class="{{ loop.cycle('bg-gray-200', 'bg-gray-100') }}">
                                        <td> {{loop.index + paging.paging_from}} </td>
                                        <td> <a href="detail?id={{item.id}}"> {{item.target}} </td>
                                        <td> {{item.hostname}} </td>
                                        <td> {{item.status}} </td>
                                        <td> {{item.init_time}} </td>
                                        <td> {{item.scan_time}} </td>
                                        <td> <a href = '/scan/detail/{{item.root_scan_id}}'> {{item.scan_id}} </a> </td>
                                        <td> {{item.scan_name}} </td>
                                        <td> {{item.nse_script}} </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <!-- End Body -->
                            </table>

                            <!-- Paging -->
                            <div id="paging" style="display:block"></div>

                            <script type='text/javascript'>
                                var paging_options = {
                                    currentPage: Math.ceil({{(paging.paging_from / paging.paging_size)}} + 0.1),
                                    totalPages: Math.ceil({{(paging.paging_total / paging.paging_size)}}),
                                    size:'normal',
                                    alignment:'center',
                                    pageUrl: function(type, page, current){
                                        fromPage = (page-1) * {{paging.paging_size}}
                                        currentURL = document.location.href;

                                        url = new URL(currentURL);
                                        url.searchParams.set('from', fromPage);
                                        
                                        return url;
                                    },
                                    onPageClicked: function(e,originalEvent,type,page){
                                        e.stopImmediatePropagation();
                                    }
                                }

                                $('#paging').bootstrapPaginator(paging_options);
                            </script>
                            <!-- Paging -->
                        </div>
                    </div>
                    <!-- Table -->
                </div>
            </div>
        </div>
    </div>
    <!-- End DataTales-->

</div>
{% endblock  %}