{% extends "index.html" %}

{% block body %}
    <h2>Scan result:</h2>
    <br>

    {% if search_query != '' %}
    <h3>
        <i>
            Showing search result for: "<span style="color: crimson">{{search_query}}</span>"
        </i>
    </h3>
    {% endif %}

    <p><b>Total: {{response.total}} </b></p>

    <div>
        Sort by:
        <select id="sort">
            <option value="1" {% if sorting == "scanstat.startTime:desc" %} selected="selected" {% endif %}>Init time desc
            </option>
            <option value="2" {% if sorting == "scanstat.startTime:asc" %} selected="selected" {% endif %}>Init time asc
            </option>
        </select>
    </div>
    <br>
    <div>
        Show: 
        <select id="paging_size">
            <option value="10" {% if paging.paging_size == 10 %} selected="selected"{% endif %}>10</option>
            <option value="20" {% if paging.paging_size == 20 %} selected="selected"{% endif %}>20</option>
            <option value="50" {% if paging.paging_size == 50 %} selected="selected"{% endif %}>50</option>
            <option value="100" {% if paging.paging_size == 100 %} selected="selected"{% endif %}>100</option>
        </select>
        Entries per page.
    </div>
    <br>

    <table style="width:100%">
        <tr>
            <th>#</th>
            <th>Scan Name</th>
            <th>Scan Description</th>
            <th>Target</th>
            <th>Created Date</th>
            <th>Next Run At</th>
            <th>Run Interval</th>
            <th>Scan Type</th>
            <th>Scanned Times</th>
            <th>Sumary Result</th>
        </tr>

        {% for item in response.records %}
        <tr>
            <td> {{loop.index + paging.paging_from}} </td>
            <td> <a href="detail/{{item.id}}"> {{item.name}} </td>
            <td> {{item.description}} </td>
            <td> {{item.target}} </td>
            <td> {{item.created_date}} </td>
            <td> {{item.next_run_at}} </td>
            <td> {{item.run_interval}} </td>
            <td> {{item.scan_type}} </td>
            <td> {{item.scanned_time}} </td>
            <td>
                <span class="vul" style="background: blue"> {{item.summary_result.informational}} </span>
                <span class="vul" style="background: green"> {{item.summary_result.low}} </span>
                <span class="vul" style="background: orange"> {{item.summary_result.medium}} </span>
                <span class="vul" style="background: red"> {{item.summary_result.high}} </span>
            </td>
        </tr>
        {% endfor %}


    </table>
    <div id="paging" style="display:block"></div>

    <script type='text/javascript'>
        var paging_options = {
            currentPage: Math.ceil({{(paging.paging_from / paging.paging_size)}} + 0.1),
            totalPages: Math.ceil({{(paging.paging_total / paging.paging_size)}}),
            size:'normal',
            alignment:'center',
            pageUrl: function(type, page, current){
                fromPage = (page-1) * {{paging.paging_size}}
                currentURL = document.location.href;

                url = new URL(currentURL);
                url.searchParams.set('from', fromPage);
                
                return url;
            },
            onPageClicked: function(e,originalEvent,type,page){
                e.stopImmediatePropagation();
            }
        }

        $('#paging').bootstrapPaginator(paging_options);
    </script>
{%endblock%}